## å¼€å¤´ï¼šå°´å°¬çš„ç¿»è½¦ç°åœº

ä»Šå¤©æˆ‘ç»å†äº†ä¸€æ¬¡æå…¶å°´å°¬çš„ Git æ“ä½œäº‹æ•…ï¼Œå°¬çš„æˆ‘è„šè¶¾æŠ åœ°å•Šå•Šå•Šå•Š...

æˆ‘åœ¨å¼€å‘ GitHub OAuth2 ç™»å½•åŠŸèƒ½ï¼Œæœ¬æ¥åªæƒ³æäº¤æ–°åˆ›å»ºçš„å‡ ä¸ªæ–‡ä»¶ï¼Œç»“æœä¸å°å¿ƒæŠŠ 180 ä¸ªæ–‡ä»¶çš„æ‰€æœ‰æ›´æ”¹éƒ½æäº¤åˆ°äº† PR åˆ†æ”¯ã€‚å½“æˆ‘åœ¨ç¾¤é‡Œçœ‹åˆ°é‚£ä¸ªæäº¤è®°å½•è¢«è¯´çš„æ—¶å€™ã€‚ã€‚ã€‚ã€‚ã€‚å“‡æ“¦ï¼å¤©å¡Œäº†ï¼
![](/blogs/my-git-disaster-experience/466a0826fa92843b.png)
```bash
# æœ¬åº”è¯¥åªæœ‰è¿™å‡ ä¸ªæ–‡ä»¶çš„æäº¤
src/consts.ts
src/lib/oauth2-github.ts
src/components/oauth2-login-button.tsx
src/hooks/use-auth.ts
src/app/(home)/config-dialog/site-settings/index.tsx

# ç»“æœå´æ˜¯è¿™æ ·çš„ææ€–åœºé¢...
modified:   src/app/(home)/config-dialog/index.tsx
modified:   src/app/about/page.tsx
modified:   src/app/blog/page.tsx
modified:   src/app/bloggers/page.tsx
modified:   src/app/pictures/page.tsx
modified:   src/app/projects/page.tsx
modified:   src/app/share/page.tsx
... (è¿˜æœ‰ 170 å¤šä¸ªæ–‡ä»¶)
```

## é”™è¯¯çš„æ ¹æºï¼šåˆ†æ”¯æ‹‰å–æé”™äº†

ç»è¿‡ä¸€ç•ªåˆ†æï¼Œæˆ‘å‘ç°é—®é¢˜çš„æ ¹æºåœ¨äºï¼š

**æˆ‘æ‹‰å–å¹²å‡€åˆ†æ”¯çš„æ—¶å€™ï¼Œæ‹‰å–çš„æ˜¯æˆ‘è‡ªå·±çš„ `main` åˆ†æ”¯ï¼Œè€Œä¸æ˜¯æºå¤´ä¸Šæ¸¸çš„æœ€æ–°ä»£ç ï¼**

è¿™å¯¼è‡´æˆ‘åœ¨ä¸€ä¸ªä¸æ˜¯æœ€æ–°åŸºç¡€ä¸Šåˆ›å»ºçš„åŠŸèƒ½åˆ†æ”¯ï¼ŒåŒ…å«äº†æ‰€æœ‰æˆ‘ä¹‹å‰åœ¨æœ¬åœ°çš„æ›´æ”¹ã€‚

### æ­£ç¡®çš„æµç¨‹åº”è¯¥æ˜¯ï¼š

1. ä»æºå¤´ä¸Šæ¸¸æ‹‰å–æœ€æ–°çš„ `main` åˆ†æ”¯
2. åœ¨æœ€æ–°åŸºç¡€ä¸Šåˆ›å»ºå¹²å‡€çš„åŠŸèƒ½åˆ†æ”¯
3. åªæäº¤ OAuth2 ç›¸å…³çš„æ–‡ä»¶
4. åˆ›å»º PR

### æˆ‘çš„é”™è¯¯æµç¨‹ï¼š

1. ä»è‡ªå·±çš„ `main` åˆ†æ”¯åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ âŒ
2. è‡ªå·±çš„ `main` å·²ç»åŒ…å«äº†ä¹‹å‰çš„å„ç§æ›´æ”¹ âŒ
3. å¯¼è‡´æ–°åˆ†æ”¯åŒ…å«äº†æ‰€æœ‰æ›´æ”¹ âŒ
4. 180 ä¸ªæ–‡ä»¶çš„æäº¤... ğŸ˜±

## ç´§æ€¥æŠ¢æ•‘ï¼šæ•‘ä¸€ä¸‹å•Šå•Šå•Šå•Šå•Š
å…ˆæŠŠpråˆ äº†ï¼Œç„¶åå¦‚ä¸‹

```bash
# 1. ä»æºå¤´ä¸Šæ¸¸è·å–æœ€æ–°ä»£ç 
git fetch upstream

# 2. åŸºäºä¸Šæ¸¸ main åˆ›å»ºæ–°çš„å¹²å‡€åˆ†æ”¯
git checkout -b clean-oauth2-final upstream/main

# 3. ä»åŸæ¥çš„æ··ä¹±åˆ†æ”¯ä¸­åªæå–éœ€è¦çš„æ–‡ä»¶
git checkout --theirs <éœ€è¦çš„æ–‡ä»¶>

# æˆ–è€…æ›´ç›´æ¥çš„æ–¹æ³•ï¼š
git checkout <åŸæ¥çš„åˆ†æ”¯> -- <å…·ä½“æ–‡ä»¶è·¯å¾„>
```

é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘æˆåŠŸæå–å‡ºäº†åªåŒ…å« OAuth2 åŠŸèƒ½çš„æ–‡ä»¶ï¼š

- `src/consts.ts` - OAuth2 é…ç½®
- `src/lib/oauth2-github.ts` - OAuth2 æ ¸å¿ƒé€»è¾‘
- `src/components/oauth2-login-button.tsx` - ç™»å½•ç»„ä»¶
- `src/hooks/use-auth.ts` - è®¤è¯çŠ¶æ€ç®¡ç†
- `src/app/(home)/config-dialog/site-settings/index.tsx` - è®¾ç½®é›†æˆ

## åˆ†æ”¯ç®¡ç†çš„æ–°è®¤çŸ¥

å•§ï¼Œå°±å½“æ˜¯åˆå­¦ä¹ åˆ°äº†gitçš„ç”¨æ³•å§ã€‚ã€‚ã€‚

AIå‘è¨€ï¼š
### 1. ç†è§£ fork å’Œ upstream çš„å…³ç³»

```bash
# æŸ¥çœ‹è¿œç¨‹ä»“åº“
git remote -v

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
origin  https://github.com/ç”¨æˆ·å/é¡¹ç›®å.git (fetch)
origin  https://github.com/ç”¨æˆ·å/é¡¹ç›®å.git (push)
upstream        https://github.com/åŸä½œè€…/é¡¹ç›®å.git (fetch)
upstream        https://github.com/åŸä½œè€…/é¡¹ç›®å.git (push)
```

- `origin`: æˆ‘ fork çš„ä»“åº“
- `upstream`: åŸä½œè€…çš„æºä»“åº“

### 2. æ­£ç¡®çš„åˆ†æ”¯åˆ›å»ºæµç¨‹

```bash
# 1. ç¡®ä¿ä¸Šæ¸¸ä»£ç æ˜¯æœ€æ–°çš„
git fetch upstream

# 2. åˆ‡æ¢åˆ°ä¸Šæ¸¸çš„ main åˆ†æ”¯
git checkout upstream/main

# 3. åŸºäºä¸Šæ¸¸ main åˆ›å»ºæ–°åŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature upstream/main

# 4. è¿›è¡Œå¼€å‘...

# 5. åªæäº¤ç›¸å…³æ–‡ä»¶
git add <ç›¸å…³æ–‡ä»¶>
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"

# 6. æ¨é€åˆ°è‡ªå·±çš„ä»“åº“ï¼Œç„¶ååˆ›å»º PR
git push origin feature/new-feature
```

### 3. éƒ¨ç½²æµ‹è¯•åˆ†æ”¯çš„åˆ›å»º

ä¸ºäº†æµ‹è¯• PR å’Œ main åˆ†æ”¯çš„åˆå¹¶å…¼å®¹æ€§ï¼Œæˆ‘ç”¨PRåˆ†æ”¯è·Ÿmainåˆ†æ”¯åˆå¹¶ä¸€ä¸ªæ–°çš„åˆ†æ”¯å»ç»™verceléƒ¨ç½²ç”¨ï¼š

```bash
# 1. åŸºäº PR åˆ†æ”¯å’Œ main åˆ†æ”¯åˆå¹¶åˆ›å»ºæµ‹è¯•åˆ†æ”¯
git checkout -b test-merge main
git merge feature/new-feature

# 2. æ¨é€æµ‹è¯•åˆ†æ”¯ç”¨äº Vercel éƒ¨ç½²æµ‹è¯•
git push origin test-merge
```
## æ‡’å¾—å†™äº†ï¼Œaiå¸®æˆ‘æ€»ç»“ä¸€ä¸‹ï¼š
## ç»éªŒæ€»ç»“

### æ•™è®­æ€»ç»“ï¼š

1. **æ°¸è¿œåŸºäºä¸Šæ¸¸æœ€æ–°ä»£ç åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**
   - ä¸è¦åœ¨è‡ªå·±çš„ main åˆ†æ”¯åŸºç¡€ä¸Šåˆ›å»ºåŠŸèƒ½åˆ†æ”¯
   - å®šæœŸåŒæ­¥ä¸Šæ¸¸ä»£ç åˆ°æœ¬åœ°

2. **æ˜ç¡®æ–‡ä»¶å˜æ›´èŒƒå›´**
   - æäº¤å‰ä¸€å®šè¦æ£€æŸ¥ `git status`
   - ç¡®ä¿åªæäº¤ç›¸å…³æ–‡ä»¶

3. **å–„ç”¨ Git çš„é«˜çº§åŠŸèƒ½**
   - `git checkout` å¯ä»¥æå–ç‰¹å®šæ–‡ä»¶
   - `git cherry-pick` å¯ä»¥åº”ç”¨ç‰¹å®šæäº¤
   - ä¸è¦å®³æ€•ç”¨ Git å‘½ä»¤è§£å†³é—®é¢˜

### æ–°çš„å·¥ä½œæµç¨‹ï¼š

```bash
# æˆ‘çš„æ–°å·¥ä½œæµç¨‹
git fetch upstream                    # åŒæ­¥ä¸Šæ¸¸
git checkout -b feature/xxx upstream/main  # åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
# å¼€å‘åŠŸèƒ½...
git add src/ç›¸å…³æ–‡ä»¶                  # åªæ·»åŠ ç›¸å…³æ–‡ä»¶
git commit -m "æè¿°æ€§æäº¤ä¿¡æ¯"        # æäº¤
git push origin feature/xxx           # æ¨é€

# åˆ›å»ºæµ‹è¯•åˆ†æ”¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
git checkout -b deploy-test main      # åŸºäº main
git merge feature/xxx                 # åˆå¹¶åŠŸèƒ½åˆ†æ”¯
git push origin deploy-test           # æ¨é€ç”¨äºéƒ¨ç½²æµ‹è¯•
```

## åç»­çš„å‘å±•

å¹¸è¿çš„æ˜¯ï¼Œæœ€ç»ˆä¸€åˆ‡éƒ½è§£å†³äº†ï¼š

1. âœ… åˆ›å»ºäº†å¹²å‡€çš„ `clean-oauth2-final` åˆ†æ”¯ï¼ŒåªåŒ…å« 7 ä¸ª OAuth2 ç›¸å…³æ–‡ä»¶
2. âœ… åˆ›å»ºäº† `feature/oauth2-auth` åˆ†æ”¯ç”¨äºæ­£å¼ PR
3. âœ… åˆ›å»ºäº† `oauth2-merged` æµ‹è¯•åˆ†æ”¯ç”¨äºéªŒè¯åˆå¹¶å…¼å®¹æ€§
4. âœ… æ‰€æœ‰åˆ†æ”¯éƒ½å·²æˆåŠŸæ¨é€

## ç»“è¯­

æ‡’å¾—å†™äº†ï¼Œè¢«è‡ªå·±è ¢åˆ°äº†ã€‚è™½ç„¶æœ€åè¿˜æ˜¯å› ä¸ºä¸èƒ½æš´éœ²GITHUB_OAUTH2_CLIENT_SECRET
è€Œè¢«passäº†å“ˆå“ˆå“ˆã€‚æˆ‘å°±çŸ¥é“ï¼

---

*ï¼ˆP.S. å¦‚æœä½ ä¹Ÿç»å†è¿‡ç±»ä¼¼çš„ Git ç¿»è½¦ç»å†ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºï¼ˆå¾…å¼€å‘ï¼‰åˆ†äº«ï¼Œè®©æˆ‘çŸ¥é“æˆ‘ä¸æ˜¯ä¸€ä¸ªäºº ğŸ˜…ï¼‰*